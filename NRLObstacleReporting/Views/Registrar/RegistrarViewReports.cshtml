
@{ 
    Layout = "~/Views/Shared/_LayoutRegistrar.cshtml";
}
@{
    ViewData["Title"] = "View Reports";
    var obstacles = (IEnumerable<ObstacleCompleteModel>)ViewData["reports"]!;
    var obstacleCompleteModels = obstacles as ObstacleCompleteModel[] ?? obstacles.ToArray();
}
@if (obstacleCompleteModels.Count() == 0)
{
    <div class="text-center py-12">
        <h1 class="text-2xl font-semibold text-gray-700">No obstacles registered</h1>
    </div>
}
else
    
{
    <div class="min-h-screen bg-white p-8">
        <h1 class="text-2xl font-bold text-gray-800 mb-6">Registered reports:</h1>
       
        <div class="flex w-screen gap-4 pt-4 mb-6"> <!-- 4 rectangle -->
            <a asp-action="PilotViewReports" asp-controller="Pilot"
               class="inline-block min-w-[200px] items-center rounded-lg py-3 px-6 font-semibold text-black bg-blue-500 hover:bg-blue-700 transition-colors duration-200">
                All
            </a>
            <a asp-action="PilotViewReports" asp-controller="Pilot"
               class="inline-block min-w-[200px] items-center rounded-lg py-3 px-6 font-semibold text-black bg-blue-500 hover:bg-blue-700 transition-colors duration-200"> 
                Pending
            </a>
            <a asp-action="PilotViewReports" asp-controller="Pilot"
               class="inline-block min-w-[200px] items-center rounded-lg py-3 px-6 font-semibold text-black bg-blue-500 hover:bg-blue-700 transition-colors duration-200">
                Approved
            </a>
            <a asp-action="PilotViewReports" asp-controller="Pilot"
               class="inline-block min-w-[200px] items-center rounded-lg py-3 px-6 font-semibold text-black bg-blue-500 hover:bg-blue-700 transition-colors duration-200"> 
                Rejected
            </a>
        </div>
        
        <!-- Type Dropdown -->    
        <select class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 inline-block w-40 p-2.5">
            <option value="" selected>Type</option>
            <option value="Aerial Span">Aerial Span</option>
            <option value="Building">Building</option>
            <option value="Bridge">Bridge</option>
            <option value="Pole/Tower">Pole/Tower</option>
            <option value="Construction">Construction</option>
            <option value="Other">Other</option>
        </select>
        <!-- Organization Dropdown --> 
        <select class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 inline-block w-40 p-2.5">
            <option value="" selected>Organization</option>
            <option value="Aerial Span">FÃ¸rste gangs tjeneste</option>
            <option value="Building"></option>
            <option value="Bridge"></option>
            <option value="Pole/Tower"></option>
            <option value="Construction"></option>
            <option value="Other"></option>
        </select>
        <!-- Status --> 
        <select class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 inline-block w-40 p-2.5">
            <option value="" selected>Status</option>
            <option value="Aerial Span">Approved</option>
            <option value="Building">Pending</option>
            <option value="Bridge">Rejected</option>
        </select>
        <!-- Org View --> 
        <select class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 inline-block w-40 p-2.5">
            <option value="" selected>Org View</option>
            <option value="Aerial Span">Aerial Span</option>
            <option value="Building">Building</option>
            <option value="Bridge">Bridge</option>
            <option value="Pole/Tower">Pole/Tower</option>
            <option value="Construction">Construction</option>
            <option value="Other">Other</option>
        </select>
        
        <div class="relative inline-block w-40">  <!-- Calender -->  
            <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"/>
                </svg>
            </div>
            <input id="datepicker-format" datepicker datepicker-format="mm-dd-yyyy" type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full ps-10 p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Select date">
        </div>
     
        <div class="relative inline-block w-40">
            <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"/>
                </svg>
            </div>
            <input id="datepicker-format" datepicker datepicker-format="mm-dd-yyyy" type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full ps-10 p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Select date">
        </div>
        
        <table class="border-collapse border border-gray-400 w-full text-left text-sm"><!-- Tabell -->
            <thead class="bg-gray-200">
            <tr>
                <th class="border border-gray-300 px-4 py-2 font-semibold text-gray-700">Name</th>
                <th class="border border-gray-300 px-4 py-2 font-semibold text-gray-700">Obstacle ID</th>
                <th class="border border-gray-300 px-4 py-2 font-semibold text-gray-700">Type</th>
                <th class="border border-gray-300 px-4 py-2 font-semibold text-gray-700">Height</th>
                <th class="border border-gray-300 px-4 py-2 font-semibold text-gray-700">Coordinates</th>
                <th class="border border-gray-300 px-4 py-2 font-semibold text-gray-700">Illuminated</th>
                <th class="border border-gray-300 px-4 py-2 font-semibold text-gray-700">Marked</th>
                <th class="border border-gray-300 px-4 py-2 font-semibold text-gray-700">Description</th>
                <th class="border border-gray-300 px-4 py-2 font-semibold text-gray-700 text-center">Status</th>
            </tr>
            </thead>
            <tbody class="bg-white">
            @foreach (var o in obstacleCompleteModels)
            {
                <tr class="hover:bg-gray-100 transition">
                    <td class="border border-gray-300 px-4 py-2">@o.Name</td>
                    <td class="border border-gray-300 px-4 py-2">@o.ObstacleId</td>
                    <td class="border border-gray-300 px-4 py-2">@o.Type</td>
                    <td class="border border-gray-300 px-4 py-2">@o.HeightMeter</td>
                    <td class="border border-gray-300 px-4 py-2">@o.GeometryGeoJson</td>
                    <td class="border border-gray-300 px-4 py-2">@o.Illuminated</td>
                    <td class="border border-gray-300 px-4 py-2">@o.Marking</td>
                    <td class="border border-gray-300 px-4 py-2">@o.Description</td>
                    <td class="border border-gray-300 px-4 py-2 text-center relative">
                        <div class="inline-block relative">
                            <button class="status-btn rounded-full px-4 py-1 font-semibold text-xs transition bg-yellow-300 text-black hover:brightness-95"
                                    onclick="toggleMenu(this)">
                                Pending
                            </button>
                            <div class="status-menu hidden absolute left-1/2 transform -translate-x-1/2 top-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg w-28 z-10">
                                <ul class="text-sm text-gray-700">
                                    <li>
                                        <button class="block w-full text-left px-3 py-1 hover:bg-yellow-300"
                                                onclick="setStatus(this, 'Pending')">Pending</button>
                                    </li>
                                    <li>
                                        <button class="block w-full text-left px-3 py-1 hover:bg-green-300"
                                                onclick="setStatus(this, 'Approved')">Approved</button>
                                    </li>
                                    <li>
                                        <button class="block w-full text-left px-3 py-1 hover:bg-red-300"
                                                onclick="setStatus(this, 'Rejected')">Rejected</button>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
}



@section Scripts {
    <script>
        
        // ===== Status-knapp i tabellen =====
        function toggleMenu(button) {
            const td = button.closest('td');
            const menu = td.querySelector('.status-menu');
            menu.classList.toggle('hidden');
        }

        function setStatus(button, status) {
            const td = button.closest('td');
            const statusBtn = td.querySelector('.status-btn');
            statusBtn.textContent = status;
            statusBtn.classList.remove('bg-yellow-200', 'bg-green-200', 'bg-red-200', 'text-yellow-800', 'text-green-800', 'text-red-800');
            if (status === 'Pending') statusBtn.classList.add('bg-yellow-200', 'text-yellow-800');
            else if (status === 'Approved') statusBtn.classList.add('bg-green-200', 'text-green-800');
            else if (status === 'Rejected') statusBtn.classList.add('bg-red-200', 'text-red-800');
            button.closest('.status-menu').classList.add('hidden');
        }

        // ===== Filter-knapper =====
        function toggleFilterDropdown(button) {
            const parent = button.parentElement;
            const menu = parent.querySelector('.filter-menu');
            menu.classList.toggle('hidden');
        }

    </script>

}



    