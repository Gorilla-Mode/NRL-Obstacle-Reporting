@using Microsoft.AspNetCore.Identity
@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - NRLObstacleReporting</title>
    <script> <!-- Dark mode pre-load (kun for pilot) -->
        (function () {
            const isPilot = localStorage.getItem("userRole") === "Pilot";
            if (isPilot) {
                const savedTheme = localStorage.getItem("theme");
                if (savedTheme === "dark") {
                    document.documentElement.classList.add("dark");
                }
            }
        })();
    </script>
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- CSS -->
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/NRLObstacleReporting.styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/lib/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="~/css/output.css" asp-append-version="true" />
    <!-- Leaflet -->
    <script src="~/lib/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
    <style>
        html, body {
            min-height: 100%;
        }
    </style>
</head>
<body class="relative min-h-screen overflow-x-hidden font-[Inter] bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-500">
    <div class="fixed inset-0 -z-10 min-h-full bg-[linear-gradient(to_bottom,_#bfdbfe_0%,_#eff6ff_50%,_#ffffff_100%)] dark:bg-[linear-gradient(to_bottom,_#1e232d_0%,_#232a36_50%,_#1c222b_100%)]
    transition-all duration-700"></div> <!-- Bakgrunn -->
    <nav class="relative flex items-center justify-between w-full px-6 shadow-sm h-[92px] bg-blue-300/30 dark:bg-gray-800/40
                backdrop-blur-xl border-b border-blue-300/30 dark:border-gray-700 transition-colors duration-500"> <!-- NAVBAR -->
        <div class="flex flex-col items-center justify-center space-y-2 py-1">
            <!-- TOGGLE: kun pilot -->
            @if (SignInManager.IsSignedIn(User) && User.IsInRole("Pilot"))
            {
                <script>localStorage.setItem("userRole", "Pilot");</script>
                <button id="theme-toggle"
                        class="relative flex items-center justify-between w-[110px] h-[34px] bg-white/60 dark:bg-gray-800/60 text-gray-700 dark:text-gray-200
                                rounded-full border border-blue-300/40 shadow-inner transition-all duration-500 px-4">
                    <div class="flex justify-between w-full items-center z-10">
                        
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M12 3v2m0 14v2m9-9h-2M5 12H3m15.364-6.364l-1.414 1.414M7.05 16.95l-1.414 1.414M16.95 16.95l1.414 1.414M7.05 7.05L5.636 5.636M12 8a4 4 0 100 8 4 4 0 000-8z" />
                        </svg> <!-- Sun -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                             <path d="M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z" />
                        </svg> <!-- Moon -->
                    </div>
                    <div id="toggle-circle"
                         class="absolute left-0 top-0 w-1/2 h-full bg-blue-500 dark:bg-blue-600 rounded-full shadow-md transform transition-transform duration-500 dark:translate-x-full"></div>
                    </button>
            }
            else
            {
                <script>localStorage.removeItem("userRole");</script>
            }
            <a asp-controller="Home" asp-action="Index" class="flex items-center justify-center gap-2 w-[110px] h-[34px] rounded-full font-medium shadow-md transition-all duration-300
                      text-white bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-400"> <!-- Home -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-4 h-4">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 9.75L12 4l9 5.75M4.5 10.5V19a1.5 1.5 0 001.5 1.5h3.75v-4.5h4.5V20.5H18a1.5 1.5 0 001.5-1.5v-8.5"/>
                </svg>
                <span>Home</span>
            </a>
        </div>
        <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 h-[92px] w-[360px] md:w-[400px] bg-white/20 dark:bg-gray-700/20 backdrop-blur-md rounded-lg shadow-md
                    flex items-center justify-center pointer-events-none z-10"> <!-- LOGO -->
            <img src="~/lib/logo/aerobarrier-logo.svg" alt="AeroBarrier logo" class="object-contain scale-[5] h-[80px] md:h-[84px] w-auto drop-shadow-md select-none" />
        </div>
        <div class="flex items-center gap-4"> <!-- Login / Logout -->
            @if (SignInManager.IsSignedIn(User))
            {
                <form asp-controller="Account" asp-action="LogOff" method="post" class="inline">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="flex items-center justify-center gap-2 px-4 h-[34px] rounded-full font-semibold shadow-md
                                                 text-white bg-blue-700 hover:bg-blue-800 dark:bg-blue-500 dark:hover:bg-blue-400 transition">
                        Log out
                    </button>
                </form>
            }
            else
            {
                <a asp-controller="Account" asp-action="Login"
                   class="flex items-center justify-center gap-2 px-4 h-[34px] rounded-full font-semibold shadow-md text-white bg-blue-700 hover:bg-blue-800
                          dark:bg-blue-500 dark:hover:bg-blue-400 transition">
                    Log in
                </a>
            }
        </div>
    </nav>
    <main class="w-full px-4 mt-6"> <!-- Innhold -->
        @RenderBody()
    </main>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="~/js/AssignValueByID.js" asp-append-version="true"></script>

    @* last kun dark-mode script for piloter *@
    @if (SignInManager.IsSignedIn(User) && User.IsInRole("Pilot"))
    {
        <script src="~/js/MapScripts/darkUx.js" asp-append-version="true"></script>
    }

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>