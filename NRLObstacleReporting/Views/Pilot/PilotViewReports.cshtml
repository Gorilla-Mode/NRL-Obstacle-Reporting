@using NRLObstacleReporting.db
@model PilotViewReportsModel

@if (!Model.SubmittedReports.Any())
{
    <div class="text-center">
        <h1 class="text-2xl font-semibold text-gray-900 dark:text-gray-100">No reports registered</h1>
    </div>
}
else
{
    <div class="text-center mb-6">
        <h1 class="py-1 sm:py-4 mb-2 text-4xl font-bold text-gray-900 dark:text-gray-100">Registered reports</h1>
    </div>
}

@foreach (var report in Model.SubmittedReports)
{
    var mapId = report.ObstacleId.ToString();

    @Html.AntiForgeryToken()

    <div class="rounded-xl 
            border border-[#1c2b45]/40 dark:border-[#0f172a]/40
            bg-[#f8fafc] dark:bg-[#1e293b]
            shadow-[0_4px_12px_rgba(0,0,0,0.15)]
            p-4 mb-10 w-full 
            transition-colors duration-300">
        <table class="w-full text-left text-sm border !border-black dark:!border-gray-100 border-collapse rounded-lg overflow-hidden">
            <tbody>
            <table class="w-full text-left text-sm border border-black border-collapse rounded-lg overflow-hidden">
                <!-- HEADER ROW -->
                <tr class="  border !border-black dark:!border-gray-100 !text-black dark:!text-gray-100">
                    <th class="p-3 text-sm font-semibold !border-black dark:!border-gray-100 bg-blue-400 !text-black dark:!text-gray-100">ObstacleID</th>
                    <td class="p-3 text-sm border !border-black dark:!border-gray-100 !text-black dark:!text-gray-100">@report.ObstacleId</td>
                </tr>

                <!-- Height -->
                <tr>
                    <th class="p-3 text-sm font-semibold border !border-black dark:!border-gray-100 bg-blue-400 !text-black dark:!text-gray-100">Height</th>
                    <td class="p-3 text-sm border !border-black dark:!border-gray-100 !text-black dark:!text-gray-100">@report.HeightMeter</td>
                </tr>

                <!-- Type -->
                <tr>
                    <th class="p-3 text-sm font-semibold border !border-black dark:!border-gray-100 bg-blue-400 !text-black dark:!text-gray-100">Type</th>
                    <td class="p-3 text-sm border !border-black dark:!border-gray-100   !text-black dark:!text-gray-100">@report.Type</td>
                </tr>

                <!-- Name -->
                <tr>
                    <th class="p-3 text-sm font-semibold border !border-black dark:!border-gray-100 bg-blue-400 !text-black dark:!text-gray-100">Name</th>
                    <td class="p-3 text-sm border !border-black dark:!border-gray-100 !text-black dark:!text-gray-100">@report.Name</td>
                </tr>

                <!-- Description -->
                <tr>
                    <th class="p-3 text-sm font-semibold border !border-black dark:!border-gray-100 bg-blue-400 text-black dark:!text-gray-100 ">Description</th>
                    <td class="p-3 text-sm border !border-black dark:!border-gray-100 !text-black dark:!text-gray-100">@report.Description</td>
                </tr>

                <!-- Illuminated -->
                <tr>
                    <th class="p-3 text-sm font-semibold border !border-black dark:!border-gray-100 bg-blue-400 !text-black dark:!text-gray-100">Illumination</th>
                    <td class="p-3 text-sm border !border-black dark:!border-gray-100 !text-black dark:!text-gray-100">@report.Illuminated</td>
                </tr>

                <!-- Marking -->
                <tr>
                    <th class="p-3 text-sm font-semibold border !border-black dark:!border-gray-100 bg-blue-400 !text-black dark:!text-gray-100">Marking</th>
                    <td class="p-3 text-sm border !border-black  dark:!border-gray-100 !text-black dark:!text-gray-100">@report.Marking</td>
                </tr>

                <!-- Created -->
                <tr>
                    <th class="p-3 text-sm font-semibold border !border-black dark:!border-gray-100 bg-blue-400 !text-black dark:!text-gray-100">Report Created:</th>
                    <td class="p-3 text-sm border !border-black  dark:!border-gray-100 !text-black dark:!text-gray-100">@report.CreationTime</td>
                </tr>

                <!-- Updated -->
                <tr>
                    <th class="p-3 text-sm font-semibold border !border-black dark:!border-gray-100 bg-blue-400  !text-black dark:!text-gray-100">Report Updated:</th>
                    <td class="p-3 text-sm border !border-black  dark:!border-gray-100 !text-black dark:!text-gray-100">@report.UpdatedTime</td>
                </tr>
                
            </table>
            <!-- MAP -->
            @if (report.GeometryGeoJson != null)
            {
                <tr class="!bg-white dark:!bg-gray-800">
                    <td colspan="2" class="p-3 text-sm font-semibold !text-black dark:!text-gray-100">

                        <details class="cursor-pointer">
                            <summary class="text-blue-600 dark:text-blue-400">Map</summary>

                            <div class="w-full overflow-hidden rounded-xl mt-3 border border-gray-300 dark:border-gray-700">
                                <div id="@mapId"
                                     class="w-full mx-auto mb-2"
                                     style="height:30dvh;width:100%;border-radius:0.75rem;overflow:hidden; z-index: 0"></div>
                            </div>

                            <script>
                                    var map = L.map('@mapId').setView([58.14671, 7.9956], 17);

                                    L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}.png', {
                                        maxZoom: 19,
                                        attribution: '&copy; OpenStreetMap contributors'
                                    }).addTo(map);

                                    var geojson = @Html.Raw(report.GeometryGeoJson);
                                    var geojsonLayer = L.geoJSON(geojson).addTo(map);

                                    map.setMaxBounds(geojsonLayer.getBounds());
                                </script>

                        </details>

                    </td>
                </tr>
            }

            </tbody>
        </table>

    </div>
}
