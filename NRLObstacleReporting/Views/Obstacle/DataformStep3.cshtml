@model NRLObstacleReporting.Models.ObstacleStep3Model
<div class="flex flex-col justify-start items-center w-full text-center pb-4 mt-0 min-h-screen">
    <div class="relative w-full flex justify-center py-3"> <!-- Progressbar -->
        <div class="relative w-[90%] max-w-3xl mx-auto flex flex-col items-center">
            <div class="absolute top-[35%] left-[15%] h-[3px] rounded-full z-0 bg-gray-300 dark:bg-gray-600" style="width: 70%;"></div> <!-- Grå bakgrunnslinje -->
            <div class="absolute top-[35%] left-[15%] h-[3px] rounded-full z-10"
                 style="width: calc(70% + 6px); background: linear-gradient(to right,#2563eb 0%,#3b82f6 30%,#60a5fa 60%,#93c5fd 100%);">
            </div> <!-- Fremdriftslinje -->
            <div class="relative flex justify-between items-center w-full z-20"> <!-- Step 1 -->
                <div class="flex flex-col items-center w-1/3 text-center">
                    <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-blue-600 text-white flex items-center justify-center shadow">
                        1
                    </div>
                    <span class="text-sm md:text-base mt-2 text-blue-600 dark:text-blue-300">
                        Select Obstacle Type
                    </span>
                </div>
                <div class="flex flex-col items-center w-1/3 text-center"> <!-- Step 2 -->
                    <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-blue-600 text-white flex items-center justify-center shadow">
                        2
                    </div>
                    <span class="text-sm md:text-base mt-2 text-blue-600 dark:text-blue-300">
                        Place Obstacle
                    </span>
                </div>
                <div class="flex flex-col items-center w-1/3 text-center"> <!-- Step 3 -->
                    <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-blue-600 text-white flex items-center justify-center shadow-md
                                ring-2 ring-offset-2 ring-blue-400 transition-all">
                        3
                    </div>
                    <span class="text-sm md:text-base mt-2 font-semibold text-blue-600 dark:text-blue-300">
                        Describe Obstacle
                    </span>
                </div>
            </div>
        </div>
    </div>
    
    <form asp-action="DataformStep3" method="post" class="flex flex-col items-center w-full"> <!-- Form -->
        @Html.AntiForgeryToken()
        <div class="shadow-2xl rounded-2xl w-[95%] max-w-6xl px-12 mt-2 min-h-[75vh] pb-12 pt-6 bg-white border border-blue-100
                    dark:!bg-[#0b1220] dark:!border-[#1c2c4a] dark:text-gray-100">
        <div class="w-full text-center mb-1 pt-4">
                <p class="text-lg font-semibold text-gray-900 dark:text-gray-100">
                    Step 3 is optional - you may submit without entering details.
                </p>
            </div>
            <div class="flex flex-col w-full items-center space-y-6"> <!-- REAL WRAPPER (only one) -->
                <input asp-for="ObstacleId" type="hidden" value="@TempData.Peek("id")" />
                <div class="w-full max-w-3xl"> <!-- Name -->
                    <label class="text-lg font-semibold block text-left mb-2 text-gray-900 dark:text-gray-200">
                        Obstacle Name
                    </label>
                    <input asp-for="Name"
                           class="rounded-xl text-lg w-full h-12 px-4 outline-none bg-blue-50 text-gray-900 border border-blue-200
                                  focus:ring-2 focus:ring-blue-400 dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600"/>
                </div>
                <div class="w-full max-w-3xl"> <!-- Description -->
                    <label class="text-lg font-semibold block text-left mb-2 text-gray-900 dark:text-gray-200">
                        Obstacle Description
                    </label>
                    <textarea asp-for="Description"
                              class="rounded-xl text-base w-full p-4 h-[16dvh] outline-none bg-blue-50 text-gray-900 border border-blue-200
                                     focus:ring-2 focus:ring-blue-400 dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600"></textarea>
                </div>
                <div class="w-full max-w-3xl"> <!-- Illumination -->
                    <label class="text-lg font-semibold block text-left mb-2 text-gray-900 dark:text-gray-200">
                        Obstacle illuminated?
                    </label>
                    <div class="flex w-full rounded-xl overflow-hidden border border-blue-200 bg-blue-50 dark:border-gray-700 dark:bg-gray-800">
                        <button type="button" id="illuminated-yes"
                                class="illumination flex-1 py-2.5 font-medium bg-blue-50 text-blue-700 hover:bg-blue-100 dark:bg-gray-800 dark:text-gray-200 dark:hover:bg-gray-700">
                            Illuminated
                        </button>
                        <button type="button" id="illuminated-unknown"
                                class="illumination flex-1 py-2.5 font-medium bg-blue-600 text-white shadow-md">
                            Unknown
                        </button>
                        <button type="button" id="illuminated-no"
                                class="illumination flex-1 py-2.5 font-medium bg-blue-50 text-blue-700 hover:bg-blue-100 dark:bg-gray-800 dark:text-gray-200 dark:hover:bg-gray-700">
                            Not Illuminated
                        </button>
                    </div>
                </div>
                <div class="w-full max-w-3xl"> <!-- Marking -->
                    <label class="text-lg font-semibold block text-left mb-2 text-gray-900 dark:text-gray-200">
                        Obstacle marked?
                    </label>
                    <div class="flex w-full rounded-xl overflow-hidden border border-blue-200 bg-blue-50 dark:border-gray-700 dark:bg-gray-800">
                        <button type="button" id="marked-yes"
                                class="marking flex-1 py-2.5 font-medium bg-blue-50 text-blue-700 hover:bg-blue-100 dark:bg-gray-800 dark:text-gray-200 dark:hover:bg-gray-700">
                            Marked
                        </button>
                        <button type="button" id="marked-unknown"
                                class="marking flex-1 py-2.5 font-medium bg-blue-600 text-white shadow-md">
                            Unknown
                        </button>
                        <button type="button" id="marked-no"
                                class="marking flex-1 py-2.5 font-medium bg-blue-50 text-blue-700 hover:bg-blue-100 dark:bg-gray-800 dark:text-gray-200 dark:hover:bg-gray-700">
                            Not Marked
                        </button>
                    </div>
                </div>
                <div class="flex justify-between w-full max-w-3xl mt-4 gap-6"> <!-- Buttons -->
                    <button type="submit"
                            class="w-[48.5%] h-20 rounded-2xl 
                   bg-gradient-to-r from-blue-100 to-blue-200 
                   text-blue-700 text-xl font-semibold tracking-wide
                   border border-blue-300
                   hover:shadow-lg hover:scale-[1.02] active:scale-[0.98]
                   transition-all duration-200
                   dark:bg-gray-800 dark:text-blue-700 dark:border-blue-700 dark:hover:bg-gray-700"
                            formaction="/Obstacle/DataformStep3" id="SaveDraft">
                        Save Draft
                    </button>
                    <button type="submit"
                            class="w-[48.5%] h-20 rounded-2xl bg-gradient-to-r from-blue-600 to-blue-500 
                   text-white text-xl font-semibold tracking-wide shadow-md 
                   hover:shadow-lg hover:brightness-110 active:scale-[0.98] 
                   border border-blue-700 transition-all duration-200"
                            formaction="/Obstacle/DataformStep3" id="Submit">
                        Submit Report
                    </button>
                </div>
                <input type="hidden" asp-for="Status" id="IsDraft" />
                <input type="hidden" asp-for="Illuminated" id="ObstacleIlluminated" value="@((int)ObstacleCompleteModel.Illumination.Unknown)" />
                <input type="hidden" asp-for="Marking" id="ObstacleMarked" value="@((int)ObstacleCompleteModel.ObstacleMarking.Unknown)" />
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        AssignValueByID('illuminated-yes', 'ObstacleIlluminated', @((int)ObstacleCompleteModel.Illumination.Illuminated));
        AssignValueByID('illuminated-no', 'ObstacleIlluminated', @((int)ObstacleCompleteModel.Illumination.NotIlluminated));
        AssignValueByID('illuminated-unknown', 'ObstacleIlluminated', @((int)ObstacleCompleteModel.Illumination.Unknown));

        AssignValueByID('marked-yes', 'ObstacleMarked', @((int)ObstacleCompleteModel.ObstacleMarking.Marked));
        AssignValueByID('marked-no', 'ObstacleMarked', @((int)ObstacleCompleteModel.ObstacleMarking.NotMarked));
        AssignValueByID('marked-unknown', 'ObstacleMarked', @((int)ObstacleCompleteModel.ObstacleMarking.Unknown));

        AssignValueByID('SaveDraft', 'IsDraft', 0);
        AssignValueByID('Submit', 'IsDraft', 1);

        function setupToggle(groupSelector) {
            const inactive = 'bg-blue-50 text-blue-700 hover:bg-blue-100 dark:bg-gray-800 dark:text-gray-200 dark:hover:bg-gray-700';
            const active = 'bg-blue-600 text-white shadow-md';

            const buttons = document.querySelectorAll(groupSelector);

            buttons.forEach(b => {
                b.addEventListener('click', () => {
                    buttons.forEach(other => {
                        other.classList.remove(...active.split(' '));
                        inactive.split(' ').forEach(c => other.classList.add(c));
                    });

                    b.classList.remove(...inactive.split(' '));
                    active.split(' ').forEach(c => b.classList.add(c));
                });
            });
        }

        setupToggle('.illumination');
        setupToggle('.marking');
    </script>
}