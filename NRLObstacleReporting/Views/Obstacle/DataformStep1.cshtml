@model NRLObstacleReporting.Models.ObstacleStep1Model
<!-- Progressbar -->
<div class="relative w-full flex justify-center mt-10 pt-0 pb-0">
    <div class="relative w-[90%] max-w-3xl mx-auto flex flex-col items-center">

        <!-- Full bakgrunnslinje (grå) -->
        <div class="absolute top-[35%] left-[15%] h-[3px] rounded-full z-0 bg-gray-300" style="width: 70%;"></div>
        
        <!-- Stegene -->
        <div class="relative flex justify-between items-center w-full z-10">

            <!-- Step 1 (aktiv) -->
            <div class="flex flex-col items-center w-1/3 text-center">
                <div class="relative flex items-center justify-center">
                    <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-blue-600 text-white flex items-center justify-center
                      ring-2 ring-offset-2 ring-blue-400 shadow-md transition-all duration-300">
                        1
                    </div>
                </div>
                <span class="text-xs sm:text-sm md:text-base mt-2 text-blue-600 font-semibold">
          Select Type
        </span>
            </div>

            <!-- Step 2 -->
            <div class="flex flex-col items-center w-1/3 text-center">
                <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-gray-300 text-gray-700 flex items-center justify-center shadow-sm">
                    2
                </div>
                <span class="text-xs sm:text-sm md:text-base mt-2 text-gray-600 font-medium">
          Place Obstacle
        </span>
            </div>

            <!-- Step 3 -->
            <div class="flex flex-col items-center w-1/3 text-center">
                <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-gray-300 text-gray-700 flex items-center justify-center shadow-sm">
                    3
                </div>
                <span class="text-xs sm:text-sm md:text-base mt-2 text-gray-600 font-medium">
          Describe Obstacle
        </span>
            </div>
        </div>
    </div>
</div>

<form method="post" class="mt-7 space-y-4">
    @Html.AntiForgeryToken()
    <div class="grid grid-cols-2 gap-3 w-full mx-auto">
        <!-- Air Span -->
        <button type="button" id="AirSpan"
                class="but flex flex-col items-center justify-center rounded-xl text-gray-900 
               bg-blue-200 hover:bg-blue-400 transition-all duration-200 border-2 border-blue-900 
               shadow-sm hover:shadow-md hover:scale-[1.02] active:scale-[0.98]"
                style="height: 17dvh;">
            <div class="flex items-center justify-center w-24 h-20 mb-3">
                <img src="https://static.thenounproject.com/png/126856-200.png"
                     class="max-h-full max-w-full object-contain" alt="Aerial Span icon" />
            </div>
            <span class="text-lg sm:text-xl font-bold text-gray-900 tracking-tight leading-snug drop-shadow-sm">
            Aerial Span
        </span>
        </button>

        <!-- Pole/Tower -->
        <button type="button" id="Pole"
                class="but flex flex-col items-center justify-center rounded-xl text-gray-900 
               bg-blue-200 hover:bg-blue-400 transition-all duration-200 border-2 border-blue-900 
               shadow-sm hover:shadow-md hover:scale-[1.02] active:scale-[0.98]"
                style="height: 17dvh;">
            <div class="flex items-center justify-center w-24 h-20 mb-3">
                <img src="https://cdn-icons-png.flaticon.com/512/82/82556.png"
                     class="max-h-full max-w-full object-contain" alt="Pole/Tower icon" />
            </div>
            <span class="text-lg sm:text-xl font-bold text-gray-900 tracking-tight leading-snug drop-shadow-sm">
            Pole/Tower
        </span>
        </button>

        <!-- Building -->
        <button type="button" id="Building"
                class="but flex flex-col items-center justify-center rounded-xl text-gray-900 
               bg-blue-200 hover:bg-blue-400 transition-all duration-200 border-2 border-blue-900 
               shadow-sm hover:shadow-md hover:scale-[1.02] active:scale-[0.98]"
                style="height: 17dvh;">
            <div class="flex items-center justify-center w-24 h-20 mb-3">
                <img src="https://www.iconpacks.net/icons/1/free-building-icon-1062-thumb.png"
                     class="max-h-full max-w-full object-contain" alt="Building icon" />
            </div>
            <span class="text-lg sm:text-xl font-bold text-gray-900 tracking-tight leading-snug drop-shadow-sm">
            Building
        </span>
        </button>

        <!-- Construction -->
        <button type="button" id="Construction"
                class="but flex flex-col items-center justify-center rounded-xl text-gray-900 
               bg-blue-200 hover:bg-blue-400 transition-all duration-200 border-2 border-blue-900 
               shadow-sm hover:shadow-md hover:scale-[1.02] active:scale-[0.98]"
                style="height: 17dvh;">
            <div class="flex items-center justify-center w-24 h-20 mb-3">
                <img src="https://cdn-icons-png.flaticon.com/512/3752/3752632.png"
                     class="max-h-full max-w-full object-contain" alt="Construction icon" />
            </div>
            <span class="text-lg sm:text-xl font-bold text-gray-900 tracking-tight leading-snug drop-shadow-sm">
            Construction
        </span>
        </button>

        <!-- Bridge -->
        <button type="button" id="Bridge"
                class="but flex flex-col items-center justify-center rounded-xl text-gray-900 
               bg-blue-200 hover:bg-blue-400 transition-all duration-200 border-2 border-blue-900 
               shadow-sm hover:shadow-md hover:scale-[1.02] active:scale-[0.98]"
                style="height: 17dvh;">
            <div class="flex items-center justify-center w-24 h-20 mb-3">
                <img src="https://www.svgrepo.com/show/490584/bridge.svg"
                     class="max-h-full max-w-full object-contain" alt="Bridge icon" />
            </div>
            <span class="text-lg sm:text-xl font-bold text-gray-900 tracking-tight leading-snug drop-shadow-sm">
            Bridge
        </span>
        </button>

        <!-- Other -->
        <button type="button" id="Other"
                class="but flex flex-col items-center justify-center rounded-xl text-gray-900 
               bg-blue-200 hover:bg-blue-400 transition-all duration-200 border-2 border-blue-900 
               shadow-sm hover:shadow-md hover:scale-[1.02] active:scale-[0.98]"
                style="height: 17dvh;">
            <div class="flex items-center justify-center w-24 h-20 mb-3">
                <img src="https://cdn-icons-png.flaticon.com/512/5895/5895032.png"
                     class="max-h-full max-w-full object-contain" alt="Other icon" />
            </div>
            <span class="text-lg sm:text-xl font-bold text-gray-900 tracking-tight leading-snug drop-shadow-sm">
            Other
        </span>
        </button>
    </div>

    <!-- Height input -->
    <div class="font-semibold mt-6">
        <label asp-for="HeightMeter" class="text-gray-700 dark:text-white text-base mb-2 block">
            Height in meter
        </label>
        <input asp-for="HeightMeter"
               class="rounded-2xl bg-white text-gray-900 text-center border-2 border-blue-400 focus:border-blue-600 focus:ring-blue-100
              focus:ring-4  w-full h-16 text-xl font-semibold shadow-md hover:shadow-lg 
              transition-all duration-300 placeholder-gray-400 tracking-wide"
               placeholder="Enter height (m)" />
        <span asp-validation-for="HeightMeter" class="text-red-500 text-sm mt-1 block"></span>
    </div>

    <!-- Action buttons -->
    <div class="flex justify-between w-full mt-6 mb-1.5">
        <!-- Save Draft -->
        <button type="submit"
                class="w-[48.5%] h-20 rounded-2xl bg-gradient-to-r from-blue-100 to-blue-200 
                   text-blue-700 text-xl font-semibold tracking-wide border border-blue-300
                   hover:shadow-lg hover:scale-[1.02] active:scale-[0.98] 
                   transition-all duration-200 flex items-center justify-center gap-3"
                formaction="/Obstacle/DataformStep1" id="savebutton">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                 stroke-width="2" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round"
                      d="M5 3a2 2 0 00-2 2v16l9-4 9 4V5a2 2 0 00-2-2H5z" />
            </svg>
            Save Draft
        </button>

        <!-- Next Page -->
        <button type="submit"
                class="w-[48.5%] h-20 rounded-2xl bg-gradient-to-r from-blue-600 to-blue-500 
                   text-white text-xl font-semibold tracking-wide shadow-md 
                   hover:shadow-lg hover:brightness-110 active:scale-[0.98] 
                   border border-blue-700 transition-all duration-200 flex items-center justify-center gap-3"
                formaction="/Obstacle/DataformStep1" id="nextpage">
            Next Page
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                 stroke-width="2" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
            </svg>
        </button>
    </div>


    <input type="hidden" asp-for="SaveDraft" id="save" />
    <input type="hidden" asp-for="Type" id="ObstacleType" />
    <div id="map" style="display: none"></div>
    <input type="hidden" asp-for="GeometryGeoJson" id="GeometryGeoJson" />
</form>

@section Scripts {
    <script src="~/js/ColorActiveButton.js"></script>
    <script src="~/js/MapScripts/GeojsonCoordinates.js"></script>
    <script src="~/js/AssignValueByID.js"></script>
    
    <script>
        GetGeoJsonCoordinates();
        //saves the value of the button/type you choose
        AssignValueByID("AirSpan", "ObstacleType", @((int)ObstacleCompleteModel.ObstacleTypes.AirSpan));
        AssignValueByID('Pole', 'ObstacleType', @((int)ObstacleCompleteModel.ObstacleTypes.PoleOrTower));
        AssignValueByID('Building', 'ObstacleType', @((int)ObstacleCompleteModel.ObstacleTypes.Building));
        AssignValueByID('Construction', 'ObstacleType', @((int)ObstacleCompleteModel.ObstacleTypes.Construction));
        AssignValueByID('Bridge', 'ObstacleType', @((int)ObstacleCompleteModel.ObstacleTypes.Bridge));
        AssignValueByID('Other', 'ObstacleType', @((int)ObstacleCompleteModel.ObstacleTypes.Other));

        //save draft or next step
        AssignValueByID('savebutton', 'save', true)
        AssignValueByID('nextpage', 'save', false)

        ColorActiveButton('bg-blue-200', 'bg-blue-500')
        document.getElementById("nextpage").addEventListener("click", function (e) {
            const typeValue = document.getElementById("ObstacleType").value;
            const heightInput = document.querySelector('input[placeholder="Enter height (m)"]');
            let hasError = false;

            // Fjern gamle feilmeldinger
            const existingError = document.getElementById("height-error-message");
            if (existingError) {
                existingError.remove();
            }

            // Fjern LIVE validation dersom brukeren ignorerer det
            const liveError = document.getElementById("height-error-live");
            if (liveError) liveError.remove();

            // Fjern røde borders - dobbeltsjekk om denne trengs eller ikke
            /*heightInput.classList.remove('input-validation-error');
            document.querySelectorAll(".but").forEach(btn => {
                btn.classList.remove("obstacle-error");
            });*/

            // Sjekk type
            if (!typeValue || typeValue === "0") {
                e.preventDefault();
                document.querySelectorAll(".but").forEach(btn => {
                    btn.classList.add("obstacle-error");
                });
                hasError = true;
            }
            // Sjekk height
            const heightValue = parseFloat(heightInput.value);
            
            if (hasError) {
                return false;
            }
        });

        // Fjern error når bruker skriver i height-feltet
        // LIVE VALIDATION FOR HEIGHT (0–150)
        const heightInput = document.querySelector('input[placeholder="Enter height (m)"]');

        if (heightInput) {
            heightInput.addEventListener("input", function () {
                const val = parseFloat(this.value);

                // Fjern serverfeilmelding (asp-validation-for)
                const serverError = document.querySelector("[data-valmsg-for='HeightMeter']");
                if (serverError) serverError.innerText = "";

                // Fjern tidligere JS-feilmelding
                const existingLiveError = document.getElementById("height-error-live");
                if (existingLiveError) existingLiveError.remove();

                // Hvis tom → ikke vis noe (bruker skriver fortsatt)
                if (this.value.trim() === "") {
                    this.classList.remove("input-validation-error");
                    return;
                }

                // RANGE CHECK (0–150)
                /*if (val < 0 || val > 150) {
                    this.classList.add("input-validation-error");

                    const msg = document.createElement("span");
                    msg.id = "height-error-live";
                    msg.className = "text-red-500 text-sm mt-1 block";
                    msg.innerText = "Height must be between 0 and 150 meter";

                    this.parentElement.appendChild(msg);
                } else {
                    this.classList.remove("input-validation-error");
                }*/
            });
        }
        // Fjern rød border når bruker klikker på en type-knapp
        document.querySelectorAll(".but").forEach(btn => {
            btn.addEventListener("click", function() {
                document.querySelectorAll(".but").forEach(b => {
                    b.classList.remove("obstacle-error");
                });
            });
        });
    
    </script>
    <partial name="_ValidationScriptsPartial" />
}