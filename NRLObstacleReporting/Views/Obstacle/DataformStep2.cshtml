@model NRLObstacleReporting.Models.ObstacleStep2Model

<div class="h-dvh overflow-hidden rounded-xl" >
    <h1 class="display-4 text-center">Welcome, please log </h1>
    <section>
        <div id="map" style="height: 65dvh; width: 100dvw; border-radius: 0.75rem; overflow: hidden; border: 1px solid #e5e7eb;">
        </div>
        <div>
            <label for="CoordinatesPreview" class="block text-sm font-medium text-gray-800 mb-1">Coordinates Preview</label>
            <textarea id="CoordinatesPreview" class="block w-full rounded-lg border-gray-300 px-3 py-2 text-sm" readonly placeholder="Draw on the map to see coordinates here..."></textarea>
        </div>
    <form asp-action="DataformStep2" method="post" class="w-full rounded-lg border-gray-300 px-3 py-2">
        <input type="hidden" asp-for="GeometryGeoJson" id="GeometryGeoJson" />
        <input asp-for="ObstacleId" type="hidden" value="@ViewBag.ObstacleId" />
        <div class="bg-green-800">
        <button class="hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded" type="submit" formaction="/Obstacle/DataformStep2" id="Submit" >Next Page</button>
        <button class="hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded" type="submit" formaction="/Obstacle/DataformStep2" id="savebutton" >Save Draft</button>
        </div>
        <input type="hidden" asp-for="SaveDraft" id="save"/>
    </form>
    </section>
</div>

@* script å få inn kart *@
@section Scripts
{
    <script>
        document.getElementById('savebutton').addEventListener('click', function () {
            document.getElementById('save').value = 'true';
         });
        document.getElementById('Submit').addEventListener('click', function () {
            document.getElementById('save').value = 'false';
         });
    </script>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
    
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>


    <script>
        var map = L.map('map').setView([58.14671, 7.9956], 13);

        L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        // Initialize the feature group that will hold the drawn shapes
         var drawnItems = new L.FeatureGroup();
         map.addLayer(drawnItems);

         // Creates the drawing control on the left hand side
         // The drawing control enables drawing of markers, polygons, and polylines
         var drawControl = new L.Control.Draw({
             draw: {
                 polygon: false,
                 polyline: true,
                 marker: true,
                 circle: false,  // Disable circle drawing
                 rectangle: true
             },
             edit: {
                 featureGroup: drawnItems
             }
         });
         map.addControl(drawControl);

          // Event handling when a layer is drawn on the map
         map.on(L.Draw.Event.CREATED, function (e) {
                 layer = e.layer;

             drawnItems.addLayer(layer);

             // Get the GeoJSON representation of the drawn layer
             var geoJsonData = layer.toGeoJSON();
             var geoJsonString = JSON.stringify(geoJsonData);

             // Set the GeoJSON string into the hidden input field in the form
             document.getElementById('GeometryGeoJson').value = geoJsonString;
             document.getElementById('CoordinatesPreview').value = geoJsonString;
         });
    </script>

    <partial name="_ValidationScriptsPartial" />
}