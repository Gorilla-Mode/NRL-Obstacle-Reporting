@model NRLObstacleReporting.Models.ObstacleStep2Model
<div class="overflow-hidden" >
    <h1 class="display-4 text-center">Place your obstacle</h1>
    <section>
        <div id="map" style="height: 60dvh; width: 100%;" class="rounded-lg">
        </div>
        <div>
            <label for="CoordinatesPreview" class="block text-sm font-medium text-gray-800 mb-1">Coordinates Preview</label>
            <textarea id="CoordinatesPreview" class="rounded-lg mb-3 bg-blue-200 text-black text-center border-2 border-blue-900"
                        style="height: 5dvh; width: 100%; margin-left: auto; margin-right: auto"
                        readonly placeholder="Draw on the map to see coordinates here...">
            </textarea>
        </div>
    <form asp-action="DataformStep2" method="post">
        <input type="hidden" asp-for="GeometryGeoJson" id="GeometryGeoJson" />
        <input asp-for="ObstacleId" type="hidden" value="@TempData.Peek("id")" />

        <div class="gap-1 grid grid-cols-2 mx-auto fixed bottom-16 left-0 right-0 px-3" style="width: 100%;">
            <button class="Btn-PilotPrimary"
                    type="submit" formaction="/Obstacle/DataformStep2" id="savebutton" >Save Draft</button>
            <button class="Btn-PilotPrimary "
                    type="submit" formaction="/Obstacle/DataformStep2" id="nextpage">Next Page</button>
        </div>
        <input type="hidden" asp-for="SaveDraft" id="save"/>
    </form>
    </section>
</div>

@* Script to add a map to the view *@
@section Scripts
{
    <script src="~/js/MapScripts/GenerateMap.js" asp-append-version="true"></script>
    <script src="~/js/MapScripts/GenerateMapItems_DataformStep2.js" asp-append-version="true"></script>
    <script src="~/js/MapScripts/GeolocateUser.js" asp-append-version="true"></script>
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.js" charset="utf-8"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
    <script>
        //save draft or next step
        AssignValueByID('savebutton', 'save', true)
        AssignValueByID('nextpage', 'save', false)

        //Generates a simple map
        const map = GenerateMap();
        GeolocateUser(17);
        //Your choice of obstacle type from the previous view
        const choice = @TempData.Peek("ObstacleType");
        
        //Generate the specific features the map needs for DataformStep2
        GenerateMapItems_DataformStep2(map, choice);
    </script>
    <partial name="_ValidationScriptsPartial" />
}